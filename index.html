<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>MK Jewels — Internal Portal</title>
    <base href="./">
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="theme-color" content="#050608" />

    <!-- PWA manifest -->
    <link rel="manifest" href="manifest.json" />

    <style>
      :root{
        --bg:#050608;
        --surface:#111318;
        --surface-soft:#181b22;
        --border:#2b303b;
        --text:#f8fafc;
        --muted:#9ca3af;
        --accent:#f2c86d;
        --accent-soft:#3b3015;
        --radius:12px;
      }
      *{box-sizing:border-box;}
      body{
        margin:0;
        font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
        background:radial-gradient(circle at top left,#433319,#050608 55%);
        color:var(--text);
      }
      .wrap{
        max-width:1100px;
        margin:0 auto;
        padding:16px 12px 40px;
      }

      /* LOGIN CARD */
      #loginSection{
        min-height:80vh;
        display:flex;
        align-items:center;
        justify-content:center;
      }
      .loginCard{
        background:linear-gradient(to bottom right,#151821,#0a0b0f);
        border-radius:18px;
        border:1px solid #3b331c;
        padding:24px 22px;
        max-width:420px;
        width:100%;
        box-shadow:0 20px 45px rgba(0,0,0,.75);
      }
      .loginTitle{
        font-size:18px;
        font-weight:600;
        margin:0 0 4px;
      }
      .loginSub{
        font-size:12px;
        color:var(--muted);
        margin:0 0 12px;
      }
      .fieldLabel{
        font-size:11px;
        text-transform:uppercase;
        letter-spacing:.08em;
        color:var(--muted);
        margin-bottom:4px;
      }
      .textInput{
        width:100%;
        border-radius:10px;
        border:1px solid var(--border);
        background:#050609;
        color:var(--text);
        padding:8px 10px;
        font-size:13px;
        outline:none;
      }
      .textInput:focus{
        border-color:var(--accent);
        box-shadow:0 0 0 1px rgba(242,200,109,.35);
      }
      .loginBtn{
        margin-top:14px;
        width:100%;
        border-radius:999px;
        border:none;
        padding:9px 0;
        font-size:13px;
        font-weight:600;
        text-transform:uppercase;
        letter-spacing:.08em;
        cursor:pointer;
        color:#2b1904;
        background:linear-gradient(to right,#f4dd94,#f2c86d);
      }
      .loginBtn:disabled{opacity:.6;cursor:wait;}
      .loginError{
        font-size:12px;
        color:#fecaca;
        margin-top:6px;
        min-height:16px;
      }

      /* APP AREA */
      #appSection{display:none;}

      .topBar{
        display:flex;
        justify-content:space-between;
        align-items:flex-start;
        gap:12px;
        margin-bottom:14px;
      }
      .title{
        margin:0 0 4px 0;
        font-size:18px;
        font-weight:600;
      }
      .sub{margin:0;font-size:12px;color:var(--muted);}
      .userBadge{
        padding:6px 10px;
        border-radius:999px;
        border:1px solid var(--border);
        background:var(--surface-soft);
        font-size:11px;
      }

      .tabs{
        display:inline-flex;
        gap:6px;
        margin-bottom:12px;
        border-radius:999px;
        padding:3px;
        background:var(--surface-soft);
        border:1px solid var(--border);
        overflow-x:auto;
        max-width:100%;
      }
      .tab{
        border:none;
        background:none;
        padding:6px 12px;
        border-radius:999px;
        font-size:12px;
        cursor:pointer;
        color:var(--muted);
        white-space:nowrap;
      }
      .tab.active{
        background:var(--accent-soft);
        color:var(--accent);
        font-weight:600;
      }

      .card{
        background:var(--surface-soft);
        border-radius:var(--radius);
        border:1px solid var(--border);
        padding:12px;
        margin-bottom:10px;
      }
      .cardTitle{font-size:13px;font-weight:600;margin-bottom:4px;}
      .cardText{font-size:12px;color:var(--muted);}
      .hidden{display:none;}

      /* FMS list */
      .fmsItem{
        padding:10px 12px;
        border-radius:10px;
        border:1px solid var(--border);
        margin-bottom:8px;
        background:linear-gradient(to right,#14151d,#111318);
      }
      .fmsName{
        font-size:13px;
        font-weight:600;
        margin-bottom:4px;
      }
      .statusBadge{
        display:inline-flex;
        align-items:center;
        gap:6px;
        font-size:11px;
        padding:4px 8px;
        border-radius:999px;
        background:#111827;
        color:var(--muted);
        margin-bottom:6px;
      }
      .dot{width:7px;height:7px;border-radius:50%}
      .g{background:#22c55e}
      .y{background:#eab308}
      .r{background:#ef4444}
      .btnRow{display:flex;gap:6px;flex-wrap:wrap;}
      .btn{
        border-radius:8px;
        border:1px solid var(--border);
        background:#020617;
        padding:6px 10px;
        font-size:11px;
        font-weight:600;
        text-transform:uppercase;
        letter-spacing:.05em;
        cursor:pointer;
        color:var(--muted);
      }
      .btnGold{
        background:linear-gradient(to bottom,#f4dd94,#f2c86d);
        border-color:#facc6b;
        color:#3b1f03;
      }
      .btnDisabled{opacity:.4;cursor:not-allowed;}

      .deptLabel{
        font-size:11px;
        text-transform:uppercase;
        letter-spacing:.08em;
        color:var(--muted);
      }
      .deptSelect{
        background:#020617;
        border-radius:999px;
        border:1px solid var(--border);
        color:var(--text);
        padding:4px 10px;
        font-size:12px;
      }

      .deptSummary{
        margin-top:8px;
        display:flex;
        flex-wrap:wrap;
        gap:6px;
      }
      .deptChip{
        font-size:11px;
        padding:3px 8px;
        border-radius:999px;
        border:1px solid var(--border);
        background:#020617;
        color:#muted;
      }
      .deptChip span{
        color:var(--accent);
        font-weight:600;
        margin-left:4px;
      }

      /* TABLES */
      .tasksTableWrapper{overflow-x:auto;}
      table.tasks{
        width:100%;
        border-collapse:collapse;
        font-size:12px;
      }
      table.tasks th,
      table.tasks td{
        padding:6px 8px;
        border-bottom:1px solid var(--border);
        text-align:left;
        white-space:nowrap;
      }
      table.tasks th{
        font-size:11px;
        text-transform:uppercase;
        letter-spacing:.08em;
        color:var(--muted);
      }
      table.tasks tbody tr:hover{
        background:#0b0f18;
      }
      .linkBtn{
        font-size:11px;
        padding:4px 8px;
        border-radius:999px;
        border:1px solid var(--border);
        background:#020617;
        color:var(--accent);
        cursor:pointer;
        text-decoration:none;
        display:inline-block;
      }

      /* Mobile tweaks */
      @media (max-width:600px){
        .wrap{
          padding:12px 10px 32px;
        }
        .loginCard{
          padding:20px 16px;
        }
        .topBar{
          flex-direction:column;
          align-items:flex-start;
        }
      }
    </style>
  </head>
  <body>
    <div class="wrap">

      <!-- LOGIN PAGE -->
      <section id="loginSection">
        <form class="loginCard" id="loginForm">
          <p class="loginTitle">MK Jewels — Internal Portal</p>
          <p class="loginSub">
            Sign in with your MK Jewels email and password to view your FMS, delegated tasks and daily tasks.
          </p>

          <div style="margin-bottom:10px;">
            <div class="fieldLabel">Login ID (Email)</div>
            <input type="email" id="loginId" class="textInput" placeholder="you@mkjewels.com" required>
          </div>
          <div>
            <div class="fieldLabel">Password</div>
            <input type="password" id="loginPass" class="textInput" placeholder="••••••••" required>
          </div>

          <button type="submit" class="loginBtn" id="loginBtn">Sign in</button>
          <div class="loginError" id="loginError"></div>
        </form>
      </section>

      <!-- MAIN APP -->
      <section id="appSection">
        <div class="topBar">
          <div>
            <p class="title" id="greet">MK JEWELS — INTERNAL PORTAL</p>
            <p class="sub">Dept-wise FMS & your daily / delegated tasks.</p>
          </div>
          <div class="userBadge" id="userInfo">Signed in</div>
        </div>

        <div class="tabs">
          <button class="tab active" data-page="home">Home</button>
          <button class="tab" data-page="fms">FMS</button>
          <button class="tab" data-page="tasks">Daily Tasks</button>
          <button class="tab" data-page="delegated">Delegated Task</button>
          <button class="tab" data-page="director">Task by Director</button>
        </div>

        <!-- HOME -->
        <section id="page-home">
          <div class="card">
            <div class="cardTitle">Welcome</div>
            <div class="cardText" id="homeText">Loading your data…</div>
          </div>
        </section>

        <!-- FMS -->
        <section id="page-fms" class="hidden">
          <div class="card">
            <div class="cardTitle">Your FMS</div>
            <div class="cardText">
              Use the dropdown to view FMS by department. FMS with blank DEPT appear under “Other”.
            </div>
            <div id="deptSummary" class="deptSummary"></div>
            <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
              <span class="deptLabel">Department</span>
              <select id="deptFilter" class="deptSelect">
                <option value="ALL">All</option>
              </select>
            </div>
          </div>
          <div id="fmsList"></div>
        </section>

        <!-- DAILY TASKS -->
        <section id="page-tasks" class="hidden">
          <div class="card">
            <div class="cardTitle">Daily Tasks</div>
            <div class="cardText">Only tasks where EMAIL ID = your login email.</div>
          </div>
          <div class="card tasksTableWrapper">
            <table class="tasks">
              <thead>
                <tr>
                  <th>TASK ID</th>
                  <th>TASK</th>
                  <th>PLANNED</th>
                  <th>STATUS</th>
                  <th>WORK COMPLETION FORM</th>
                </tr>
              </thead>
              <tbody id="tasksBody"></tbody>
            </table>
          </div>
        </section>

        <!-- DELEGATED TASK -->
        <section id="page-delegated" class="hidden">
          <div class="card">
            <div class="cardTitle">Delegated Task</div>
            <div class="cardText">
              Tasks from the <b>Delegated Task</b> sheet where you are the assignee, split by WORK STAGE.
            </div>
          </div>

          <div class="card tasksTableWrapper">
            <div class="cardTitle">Stage 2 — Work &amp; Upload</div>
            <table class="tasks">
              <thead>
                <tr>
                  <th>TIMESTAMP</th>
                  <th>ASSIGNEE</th>
                  <th>TYPE OF THE TASK</th>
                  <th>TASK DETAILS</th>
                  <th>TASK DETAILS IN AUDIO/ VIDEO</th>
                  <th>TASK DUE</th>
                  <th>UPLOAD / REVISED DATE</th>
                  <th>TASK PRIORITY</th>
                  <th>TAT PLANNED</th>
                  <th>WORK COMPLETION FORM</th>
                </tr>
              </thead>
              <tbody id="delegatedStage2Body"></tbody>
            </table>
          </div>

          <div class="card tasksTableWrapper">
            <div class="cardTitle">Stage 3 — Review &amp; Remark</div>
            <table class="tasks">
              <thead>
                <tr>
                  <th>TIMESTAMP</th>
                  <th>ASSIGNEE</th>
                  <th>TYPE OF THE TASK</th>
                  <th>TASK DETAILS</th>
                  <th>TASK DETAILS IN AUDIO/ VIDEO</th>
                  <th>TASK DUE</th>
                  <th>USER UPLOAD</th>
                  <th>TASK PRIORITY</th>
                  <th>TAT PLANNED</th>
                  <th>WORK COMPLETION FORM</th>
                </tr>
              </thead>
              <tbody id="delegatedStage3Body"></tbody>
            </table>
          </div>
        </section>

        <!-- TASK DELEGATED BY DIRECTOR -->
        <section id="page-director" class="hidden">
          <div class="card">
            <div class="cardTitle">Task Delegated by Director</div>
            <div class="cardText">
              Tasks from the <b>Task Delegated by Director</b> sheet where you are the assignee, split by WORK STAGE.
            </div>
          </div>

          <div class="card tasksTableWrapper">
            <div class="cardTitle">Stage 2 — Work &amp; Upload</div>
            <table class="tasks">
              <thead>
                <tr>
                  <th>TIMESTAMP</th>
                  <th>ASSIGNEE</th>
                  <th>TASK DETAILS</th>
                  <th>TASK DETAILS IN AUDIO/ VIDEO</th>
                  <th>TASK DUE</th>
                  <th>UPLOAD / REVISED DATE</th>
                  <th>TASK PRIORITY</th>
                  <th>TAT PLANNED</th>
                  <th>WORK COMPLETION FORM</th>
                </tr>
              </thead>
              <tbody id="directorStage2Body"></tbody>
            </table>
          </div>

          <div class="card tasksTableWrapper">
            <div class="cardTitle">Stage 3 — Review &amp; Remark</div>
            <table class="tasks">
              <thead>
                <tr>
                  <th>TIMESTAMP</th>
                  <th>ASSIGNEE</th>
                  <th>TASK DETAILS</th>
                  <th>TASK DETAILS IN AUDIO/ VIDEO</th>
                  <th>TASK DUE</th>
                  <th>USER UPLOAD</th>
                  <th>TASK PRIORITY</th>
                  <th>TAT PLANNED</th>
                  <th>WORK COMPLETION FORM</th>
                </tr>
              </thead>
              <tbody id="directorStage3Body"></tbody>
            </table>
          </div>
        </section>
      </section>
    </div>

    <script>
      /******** CONFIG: your Apps Script web app URL ********/
      const API_URL = 'YOUR_APPS_SCRIPT_WEB_APP_URL_HERE'; // <-- change this

      /******** small helpers ********/
      function statusDot(status){
        status = String(status || "").toUpperCase();
        if(status === "READY") return "g";
        if(status === "WORKING") return "y";
        return "r";
      }
      function statusLabel(status){
        status = String(status || "").toUpperCase();
        if(status === "READY") return "Ready";
        if(status === "WORKING") return "Working";
        return "Disabled";
      }
      function openLink(url){
        url = String(url || "").trim();
        if(!url) return;
        const w = window.open(url, "_blank", "noopener,noreferrer");
        if(!w){
          const a = document.createElement("a");
          a.href = url;
          a.target = "_blank";
          a.rel = "noopener noreferrer";
          document.body.appendChild(a); a.click(); document.body.removeChild(a);
        }
      }
      function showPage(page){
        document.querySelectorAll(".tab").forEach(t=>{
          t.classList.toggle("active", t.dataset.page === page);
        });
        document.querySelectorAll("#appSection > section[id^='page-']").forEach(sec=>{
          sec.classList.toggle("hidden", sec.id !== "page-" + page);
        });
      }
      document.querySelectorAll(".tab").forEach(btn=>{
        btn.addEventListener("click", ()=>showPage(btn.dataset.page));
      });

      /******** FMS ********/
      let allFms = [];
      let currentDeptFilter = "ALL";

      function renderDeptSummary(counts){
        const el = document.getElementById("deptSummary");
        if(!el) return;
        const keys = Object.keys(counts || {});
        if(!keys.length){ el.innerHTML = ""; return; }
        const items = Object.entries(counts)
          .sort((a,b)=>a[0].localeCompare(b[0]))
          .map(([dept,c])=>`<div class="deptChip">${dept}<span>${c}</span></div>`);
        el.innerHTML = items.join("");
      }

      function buildDeptDropdown(){
        const sel = document.getElementById("deptFilter");
        if(!sel) return;
        const set = new Set();
        allFms.forEach(row=>{
          const d = (row.dept && String(row.dept).trim()) || "Other";
          set.add(d);
        });
        const depts = Array.from(set).sort((a,b)=>a.localeCompare(b));
        sel.innerHTML = `<option value="ALL">All</option>` +
          depts.map(d=>`<option value="${d}">${d}</option>`).join("");
        sel.value = currentDeptFilter || "ALL";
        sel.onchange = ()=>{ currentDeptFilter = sel.value; renderFmsFiltered(); };
      }

      function renderFms(fms){
        allFms = fms || [];
        currentDeptFilter = "ALL";

        const counts = {};
        allFms.forEach(row=>{
          const d = (row.dept && String(row.dept).trim()) || "Other";
          counts[d] = (counts[d] || 0) + 1;
        });
        renderDeptSummary(counts);
        buildDeptDropdown();
        renderFmsFiltered();
      }

      function renderFmsFiltered(){
        const fmsList = document.getElementById("fmsList");
        fmsList.innerHTML = "";
        if(!allFms.length){
          fmsList.innerHTML = "<div class='cardText'>No FMS configured.</div>";
          return;
        }

        const selected = currentDeptFilter;
        if(!selected || selected === "ALL"){
          fmsList.innerHTML = "<div class='cardText'>Select a department from the dropdown to view its FMS.</div>";
          return;
        }

        const rows = allFms.filter(row=>{
          const d = (row.dept && String(row.dept).trim()) || "Other";
          return d === selected;
        });

        if(!rows.length){
          fmsList.innerHTML = "<div class='cardText'>No FMS in this department.</div>";
          return;
        }

        rows.forEach(row=>{
          const card = document.createElement("div");
          card.className = "fmsItem";

          const rawName = row.name || "";
          const cleanName = rawName.replace(/^\[[^\]]+\]\s*/,"");

          card.innerHTML = `
            <div class="fmsName">${cleanName}</div>
            <div class="statusBadge">
              <span class="dot ${statusDot(row.status)}"></span>
              ${statusLabel(row.status)}
            </div>
            <div class="btnRow">
              <button class="btn btnGold ${row.fms ? "" : "btnDisabled"}">Open FMS</button>
              <button class="btn ${row.form ? "" : "btnDisabled"}">Open Form</button>
            </div>`;
          const btns = card.querySelectorAll("button");
          btns[0].onclick = ()=>row.fms && openLink(row.fms);
          btns[1].onclick = ()=>row.form && openLink(row.form);
          fmsList.appendChild(card);
        });
      }

      /******** DAILY TASKS ********/
      function renderTasks(tasks){
        const body = document.getElementById("tasksBody");
        body.innerHTML = "";
        if(!tasks || !tasks.length){
          body.innerHTML = `<tr><td colspan="5" style="color:var(--muted);">No tasks assigned to you.</td></tr>`;
          return;
        }
        tasks.forEach(t=>{
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${t.taskId || ""}</td>
            <td>${t.task || ""}</td>
            <td>${t.planned || ""}</td>
            <td>${t.status || ""}</td>
            <td>${
              t.formUrl
                ? `<a class="linkBtn" href="${t.formUrl}" target="_blank" rel="noopener noreferrer">OPEN</a>`
                : ""
            }</td>`;
          body.appendChild(tr);
        });
      }

      /******** DELEGATED TASKS ********/
      function renderDelegated(delegated){
        const s2 = delegated && delegated.stage2 ? delegated.stage2 : [];
        const s3 = delegated && delegated.stage3 ? delegated.stage3 : [];

        const body2 = document.getElementById("delegatedStage2Body");
        const body3 = document.getElementById("delegatedStage3Body");
        body2.innerHTML = "";
        body3.innerHTML = "";

        if(!s2.length){
          body2.innerHTML = `<tr><td colspan="10" style="color:var(--muted);">No Stage 2 tasks.</td></tr>`;
        } else {
          s2.forEach(t=>{
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${t.timestamp || ""}</td>
              <td>${t.assignee || ""}</td>
              <td>${t.type || ""}</td>
              <td>${t.details || ""}</td>
              <td>${t.audio || ""}</td>
              <td>${t.due || ""}</td>
              <td>${t.upload || ""}</td>
              <td>${t.priority || ""}</td>
              <td>${t.tat || ""}</td>
              <td>${
                t.formUrl
                  ? `<a class="linkBtn" href="${t.formUrl}" target="_blank" rel="noopener noreferrer">OPEN</a>`
                  : ""
              }</td>`;
            body2.appendChild(tr);
          });
        }

        if(!s3.length){
          body3.innerHTML = `<tr><td colspan="10" style="color:var(--muted);">No Stage 3 tasks.</td></tr>`;
        } else {
          s3.forEach(t=>{
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${t.timestamp || ""}</td>
              <td>${t.assignee || ""}</td>
              <td>${t.type || ""}</td>
              <td>${t.details || ""}</td>
              <td>${t.audio || ""}</td>
              <td>${t.due || ""}</td>
              <td>${t.upload || ""}</td>
              <td>${t.priority || ""}</td>
              <td>${t.tat || ""}</td>
              <td>${
                t.formUrl
                  ? `<a class="linkBtn" href="${t.formUrl}" target="_blank" rel="noopener noreferrer">OPEN</a>`
                  : ""
              }</td>`;
            body3.appendChild(tr);
          });
        }
      }

      /******** DIRECTOR TASKS ********/
      function renderDirector(director){
        const s2 = director && director.stage2 ? director.stage2 : [];
        const s3 = director && director.stage3 ? director.stage3 : [];

        const body2 = document.getElementById("directorStage2Body");
        const body3 = document.getElementById("directorStage3Body");
        body2.innerHTML = "";
        body3.innerHTML = "";

        if(!s2.length){
          body2.innerHTML = `<tr><td colspan="9" style="color:var(--muted);">No Stage 2 tasks.</td></tr>`;
        } else {
          s2.forEach(t=>{
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${t.timestamp || ""}</td>
              <td>${t.assignee || ""}</td>
              <td>${t.details || ""}</td>
              <td>${t.audio || ""}</td>
              <td>${t.due || ""}</td>
              <td>${t.upload || ""}</td>
              <td>${t.priority || ""}</td>
              <td>${t.tat || ""}</td>
              <td>${
                t.formUrl
                  ? `<a class="linkBtn" href="${t.formUrl}" target="_blank" rel="noopener noreferrer">OPEN</a>`
                  : ""
              }</td>`;
            body2.appendChild(tr);
          });
        }

        if(!s3.length){
          body3.innerHTML = `<tr><td colspan="9" style="color:var(--muted);">No Stage 3 tasks.</td></tr>`;
        } else {
          s3.forEach(t=>{
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${t.timestamp || ""}</td>
              <td>${t.assignee || ""}</td>
              <td>${t.details || ""}</td>
              <td>${t.audio || ""}</td>
              <td>${t.due || ""}</td>
              <td>${t.upload || ""}</td>
              <td>${t.priority || ""}</td>
              <td>${t.tat || ""}</td>
              <td>${
                t.formUrl
                  ? `<a class="linkBtn" href="${t.formUrl}" target="_blank" rel="noopener noreferrer">OPEN</a>`
                  : ""
              }</td>`;
            body3.appendChild(tr);
          });
        }
      }

      /******** DASHBOARD ********/
      function renderDashboard(data){
        const { profile, fms, tasks, delegated, directorTasks } = data;

        document.getElementById("greet").textContent =
          "Hello, " + (profile.name || profile.email);
        document.getElementById("userInfo").textContent =
          profile.email + " • " + (profile.role || "STAFF") +
          (profile.dept ? " • " + profile.dept : "");

        document.getElementById("homeText").textContent =
          `You are logged in as ${profile.name || profile.email}. ` +
          `Role: ${profile.role || "STAFF"}${profile.dept ? " • Dept: " + profile.dept : ""}.`;

        renderFms(fms);
        renderTasks(tasks);
        renderDelegated(delegated);
        renderDirector(directorTasks);
      }

      /******** LOGIN HANDLER (fetch to Apps Script) ********/
      document.getElementById("loginForm").addEventListener("submit", function(e){
        e.preventDefault();
        const id  = document.getElementById("loginId").value.trim();
        const pw  = document.getElementById("loginPass").value.trim();
        const btn = document.getElementById("loginBtn");
        const err = document.getElementById("loginError");
        err.textContent = "";
        if (!id || !pw) {
          err.textContent = "Email and password required.";
          return;
        }
        btn.disabled = true;

        const body = new URLSearchParams({
          action: 'login',
          email: id,
          password: pw
        });

        fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body
        })
        .then(res => res.json())
        .then(res => {
          btn.disabled = false;
          if (!res.ok) {
            throw new Error(res.error || 'Login failed');
          }
          const data = res.data;
          document.getElementById("loginSection").style.display = "none";
          document.getElementById("appSection").style.display = "block";
          showPage("home");
          renderDashboard(data);
        })
        .catch(error => {
          btn.disabled = false;
          err.textContent = error.message || String(error);
        });
      });

      /******** Register Service Worker for PWA ********/
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./service-worker.js')
            .catch(err => console.error('SW registration failed', err));
        });
      }
    </script>
  </body>
</html>
